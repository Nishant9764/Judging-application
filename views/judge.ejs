<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Judge Scoring Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="/CSS/judge.css">
</head>
<body class="bg-gray-50 text-gray-800">

    <%
        // --- MOCK DATA ---
        // In a real EJS application, this data would be passed from your server, e.g., res.render('judge', { judgeData });
        const judgeData = {
            name: "Judge",
            stats: {
                assignedEvents: 3,
                totalStudents: 35,
                studentsScored: 16,
                completed: 1
            },
            events: [
                {
                    id: 'evt-poetry',
                    title: "Poetry Recitation",
                    subtitle: "St. Mary's High School - Senior Poetry",
                    status: "in-progress",
                    deadline: "15/2/2024",
                    students: [
                        { id: 'stu-emma', name: "Emma Thompson", scored: true, scores: { clarity: 8, confidence: 7, creativity: 9 }, comments: "Very clear and well-recited." },
                        { id: 'stu-alex', name: "Alex Johnson", scored: true, scores: { clarity: 6, confidence: 8, creativity: 7 }, comments: "" },
                        { id: 'stu-sarah', name: "Sarah Wilson", scored: false, scores: { clarity: 5, confidence: 5, creativity: 5 }, comments: "" },
                        { id: 'stu-michael', name: "Michael Brown", scored: false, scores: { clarity: 0, confidence: 0, creativity: 0 }, comments: "" },
                        { id: 'stu-jessica', name: "Jessica Davis", scored: false, scores: { clarity: 0, confidence: 0, creativity: 0 }, comments: "" },
                        { id: 'stu-david', name: "David Miller", scored: true, scores: { clarity: 9, confidence: 9, creativity: 8 }, comments: "" },
                        { id: 'stu-lisa', name: "Lisa Anderson", scored: false, scores: { clarity: 0, confidence: 0, creativity: 0 }, comments: "" },
                        { id: 'stu-chris', name: "Chris Martinez", scored: false, scores: { clarity: 0, confidence: 0, creativity: 0 }, comments: "" },
                    ],
                    totalStudents: 12
                },
                {
                    id: 'evt-art',
                    title: "Art Competition",
                    subtitle: "St. Mary's High School - Creative Arts",
                    status: "pending",
                    deadline: "20/2/2024",
                    students: [],
                    totalStudents: 15
                },
                {
                    id: 'evt-science',
                    title: "Science Fair",
                    subtitle: "Riverside Elementary - Junior Science",
                    status: "completed",
                    deadline: "10/2/2024",
                    students: [],
                    totalStudents: 8
                }
            ]
        };
    %>

    <div id="app-container" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center gap-3">
                <div class="bg-gray-800 text-white p-3 rounded-lg">
                    <i data-feather="user-check" class="w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-900">School Events Judge</h1>
                    <p class="text-sm text-gray-500">Judge Panel</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <span class="font-semibold">judge</span>
                <form method="post" action="/logout">
                    <button class="flex items-center gap-2 text-gray-600 hover:text-gray-900">
                    <i data-feather="log-out" class="w-5 h-5"></i>
                    <span>Logout</span>
                </button>
                </form>
                
            </div>
        </header>

        <main>
            <div id="dashboard-view">
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-900">Welcome back, <%= judgeData.name %>!</h2>
                    <p class="text-gray-600">You have <%= judgeData.stats.assignedEvents %> events assigned. Here's your current progress:</p>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                    <div class="bg-white p-6 rounded-xl border border-gray-200 flex items-center gap-4">
                        <div class="bg-blue-100 text-blue-600 p-3 rounded-lg"><i data-feather="calendar"></i></div>
                        <div>
                            <p class="text-gray-500 text-sm">Assigned Events</p>
                            <p class="text-2xl font-bold"><%= judgeData.stats.assignedEvents %></p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-gray-200 flex items-center gap-4">
                        <div class="bg-green-100 text-green-600 p-3 rounded-lg"><i data-feather="users"></i></div>
                        <div>
                            <p class="text-gray-500 text-sm">Total Students</p>
                            <p class="text-2xl font-bold"><%= judgeData.stats.totalStudents %></p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-gray-200 flex items-center gap-4">
                         <div class="bg-purple-100 text-purple-600 p-3 rounded-lg"><i data-feather="edit-3"></i></div>
                        <div>
                            <p class="text-gray-500 text-sm">Students Scored</p>
                            <p class="text-2xl font-bold"><%= judgeData.stats.studentsScored %></p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-gray-200 flex items-center gap-4">
                        <div class="bg-yellow-100 text-yellow-600 p-3 rounded-lg"><i data-feather="check-circle"></i></div>
                        <div>
                            <p class="text-gray-500 text-sm">Completed</p>
                            <p class="text-2xl font-bold"><%= judgeData.stats.completed %></p>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-gray-900 mb-6">Your Assigned Events</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <% judgeData.events.forEach(event => { %>
                            <div class="bg-white p-6 rounded-xl border border-gray-200 flex flex-col">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="text-lg font-bold"><%= event.title %></h4>
                                    <% if (event.status === 'in-progress') { %>
                                        <span class="text-xs font-medium bg-blue-100 text-blue-800 px-2.5 py-1 rounded-full">in-progress</span>
                                    <% } else if (event.status === 'pending') { %>
                                        <span class="text-xs font-medium bg-yellow-100 text-yellow-800 px-2.5 py-1 rounded-full">pending</span>
                                    <% } else if (event.status === 'completed') { %>
                                        <span class="text-xs font-medium bg-green-100 text-green-800 px-2.5 py-1 rounded-full">completed</span>
                                    <% } %>
                                </div>
                                <p class="text-sm text-gray-500 mb-4"><%= event.subtitle %></p>
                                
                                <div class="flex-grow"></div>

                                <% const scoredStudents = event.students.filter(s => s.scored).length; %>
                                <% const progress = event.totalStudents > 0 ? (scoredStudents / event.totalStudents) * 100 : (event.status === 'completed' ? 100 : 0); %>

                                <div class="mb-1">
                                    <p class="text-sm font-medium">Progress</p>
                                </div>
                                <div class="w-full progress-bar-bg rounded-full h-2.5 mb-1">
                                    <!-- <div class="bg-blue-600 h-2.5 rounded-full" style="width: <%= progress %>%"></div> -->
                                </div>
                                <p class="text-sm text-gray-500 mb-4"><%= scoredStudents %> of <%= event.totalStudents %> students</p>

                                <p class="text-sm text-gray-500 mb-6"><strong>Deadline:</strong> <%= event.deadline %></p>

                                <% if (event.status === 'in-progress') { %>
                                    <button data-event-id="<%= event.id %>" class="w-full bg-gray-800 text-white font-semibold py-3 rounded-lg hover:bg-gray-900 transition-colors">Continue Scoring</button>
                                <% } else if (event.status === 'pending') { %>
                                    <button data-event-id="<%= event.id %>" class="w-full bg-gray-800 text-white font-semibold py-3 rounded-lg hover:bg-gray-900 transition-colors">Start Scoring</button>
                                <% } else if (event.status === 'completed') { %>
                                    <button class="w-full bg-white text-gray-800 font-semibold py-3 rounded-lg border border-gray-300 hover:bg-gray-100 transition-colors">Review Scores</button>
                                <% } %>
                            </div>
                        <% }); %>
                    </div>
                </div>
            </div>

            <div id="scoring-view" class="hidden">
                 <div class="mb-8">
                    <button onclick="showDashboardView()" class="flex items-center gap-2 text-gray-600 hover:text-gray-800 font-semibold">
                        <i data-feather="arrow-left" class="w-5 h-5"></i>
                        Back to Dashboard
                    </button>
                </div>

                <div class="bg-white p-4 sm:p-6 rounded-xl border border-gray-200 mb-6">
                    <h2 id="scoring-event-title" class="text-2xl font-bold"></h2>
                    <p id="scoring-event-subtitle" class="text-gray-500"></p>
                </div>

                <div class="flex flex-col lg:flex-row gap-8">
                    <aside class="lg:w-1/4">
                        <div class="bg-white p-4 rounded-xl border border-gray-200">
                            <h3 id="student-list-header" class="font-bold mb-2">Students (0)</h3>
                            <div class="w-full progress-bar-bg rounded-full h-2 mb-4">
                                <div id="student-progress-bar" class="bg-green-500 h-2 rounded-full" style="width: 0%;"></div>
                            </div>
                            <p id="student-progress-text" class="text-sm text-gray-500 mb-4">0% complete</p>
                            <ul id="student-list-ul" class="space-y-2">
                                </ul>
                        </div>
                    </aside>

                    <section class="flex-1">
                        <div id="scoring-panel" class="bg-white p-6 sm:p-8 rounded-xl border border-gray-200">
                             <div class="text-center p-12 text-gray-500">
                                <p>Select a student from the list to start scoring.</p>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Pass server-side data to the client-side script
        // const judgeData = <%- JSON.stringify(judgeData) %>;
    </script>
    <script src="/js/judge.js"></script>
</body>
</html>